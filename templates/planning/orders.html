<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders - PMS</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">PMS</div>
            <nav class="nav">
                <a href="/dashboard" class="nav-link">Dashboard</a>
                <a href="/planning/orders" class="nav-link active">Planning</a>
                <a href="/defects/replacement-tickets" class="nav-link">Defects</a>
                <a href="/sop/tickets" class="nav-link">SOP & NCR</a>
                <a href="/maintenance/tickets" class="nav-link">Maintenance</a>
                <a href="/admin/departments" class="nav-link">Admin</a>
            </nav>
            <div class="user-menu">
                <div class="notification-badge">
                    <span class="badge hidden-badge">0</span>
                    <span>üîî</span>
                </div>
                <span id="username"></span>
                <button class="btn btn-sm btn-secondary logout-btn">Logout</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="page-header-flex">
            <h1>Orders</h1>
            <div class="page-actions-group">
                <button class="btn btn-secondary">Import Orders</button>
                <button class="btn btn-primary add-order-btn">Add Order</button>
            </div>
        </div>
        
        <div id="exceptionAlert" class="alert alert-warning" style="display: none; margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>‚ö†Ô∏è Production Exceptions Detected</strong>
                    <p id="exceptionSummary" style="margin: 8px 0 0 0;"></p>
                </div>
                <button class="btn btn-sm btn-primary" id="viewExceptionsBtn">View Details</button>
            </div>
        </div>
        
        <div class="card card-margin-bottom">
            <div class="filter-group">
                <select id="statusFilter" class="form-select filter-select">
                    <option value="">All Statuses</option>
                    <option value="unscheduled">Unscheduled</option>
                    <option value="scheduled">Scheduled</option>
                    <option value="in_progress">In Progress</option>
                    <option value="completed">Completed</option>
                    <option value="on_hold">On Hold</option>
                </select>
                
                <input type="text" id="customerSearch" class="form-input search-input" placeholder="Search customer...">
            </div>
        </div>
        
        <div class="card">
            <table class="table">
                <thead>
                    <tr>
                        <th>Order Number</th>
                        <th>Customer</th>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Value</th>
                        <th>Dates</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="ordersTable">
                    <tr><td colspan="8" class="loading">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <div id="addOrderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add Order</div>
            <form id="orderForm">
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label" for="orderNumber">Order Number*</label>
                        <input type="text" id="orderNumber" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="salesOrderNumber">Sales Order Number</label>
                        <input type="text" id="salesOrderNumber" class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="customerName">Customer Name*</label>
                    <input type="text" id="customerName" class="form-input" required>
                </div>
                
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label" for="quantity">Quantity*</label>
                        <input type="number" id="quantity" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="orderValue">Order Value</label>
                        <input type="number" id="orderValue" class="form-input" step="0.01">
                    </div>
                </div>
                
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label" for="startDate">Start Date</label>
                        <input type="date" id="startDate" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="endDate">End Date</label>
                        <input type="date" id="endDate" class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="notes">Notes</label>
                    <textarea id="notes" class="form-textarea"></textarea>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn" data-modal="addOrderModal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="orderItemsModal" class="modal">
        <div class="modal-content modal-content-wide">
            <div class="modal-header">Manage Order Items</div>
            <div class="card-margin-bottom">
                <button class="btn btn-primary btn-sm add-item-btn">Add Item</button>
            </div>
            
            <div id="itemFormContainer" class="item-form-container">
                <h3 id="itemFormTitle">Add Item</h3>
                <form id="itemForm">
                    <input type="hidden" id="itemId">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Product*</label>
                            <select id="itemProductId" class="form-select" required></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quantity*</label>
                            <input type="number" id="itemQuantity" class="form-input" required min="1">
                        </div>
                    </div>
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Unit Price</label>
                            <input type="number" id="itemUnitPrice" class="form-input" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Specifications</label>
                            <input type="text" id="itemSpecifications" class="form-input">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-sm">Save</button>
                        <button type="button" class="btn btn-secondary btn-sm cancel-item-btn">Cancel</button>
                    </div>
                </form>
            </div>
            
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Total</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="orderItemsTable">
                    <tr><td colspan="6" class="loading">Loading...</td></tr>
                </tbody>
            </table>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal-btn" data-modal="orderItemsModal">Close</button>
            </div>
        </div>
    </div>
    
    <div id="productionPathModal" class="modal">
        <div class="modal-content modal-content-extra-wide">
            <div class="modal-header">Manage Production Path</div>
            <div class="card-margin-bottom">
                <button class="btn btn-primary btn-sm add-path-step-btn">Add Step</button>
            </div>
            
            <div id="pathStepFormContainer" class="item-form-container">
                <h3 id="pathStepFormTitle">Add Production Step</h3>
                <form id="pathStepForm">
                    <input type="hidden" id="pathStepId">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Department*</label>
                            <select id="pathDepartmentId" class="form-select" required></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Stage</label>
                            <select id="pathStageId" class="form-select"></select>
                        </div>
                    </div>
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Estimated Duration (minutes)</label>
                            <input type="number" id="pathEstimatedDuration" class="form-input" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="pathIsRequired" checked>
                                Required Step
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea id="pathNotes" class="form-textarea"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-sm">Save</button>
                        <button type="button" class="btn btn-secondary btn-sm cancel-path-step-btn">Cancel</button>
                    </div>
                </form>
            </div>
            
            <table class="table">
                <thead>
                    <tr>
                        <th>Sequence</th>
                        <th>Department</th>
                        <th>Stage</th>
                        <th>Duration</th>
                        <th>Required</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="productionPathTable">
                    <tr><td colspan="6" class="loading">Loading...</td></tr>
                </tbody>
            </table>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal-btn" data-modal="productionPathModal">Close</button>
            </div>
        </div>
    </div>
    
    <div id="exceptionDetailsModal" class="modal">
        <div class="modal-content modal-content-ultra-wide">
            <div class="modal-header">
                <span>Production Exceptions - Orders On Hold</span>
            </div>
            
            <div class="grid grid-3 card-margin-bottom-lg">
                <div class="stat-card stat-card-danger">
                    <div class="stat-label">Orders On Hold</div>
                    <div class="stat-value" id="exceptionCount">0</div>
                </div>
                <div class="stat-card stat-card-warning">
                    <div class="stat-label">Order Value At Risk</div>
                    <div class="stat-value" id="exceptionValue">R 0.00</div>
                </div>
                <div class="stat-card stat-card-danger">
                    <div class="stat-label">Total Cost Impact</div>
                    <div class="stat-value" id="exceptionCost">R 0.00</div>
                </div>
            </div>
            
            <div class="table-wrapper">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Order Number</th>
                            <th>Customer</th>
                            <th>Product</th>
                            <th>Quantity</th>
                            <th>Hold Reason</th>
                            <th>Defect Ticket</th>
                            <th>Department</th>
                            <th>Cost Impact</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="exceptionOrdersTable">
                        <tr><td colspan="9" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal-btn" data-modal="exceptionDetailsModal">Close</button>
            </div>
        </div>
    </div>
    
    <script src="/static/js/api.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/modules/orders.js"></script>
</body>
</html>
