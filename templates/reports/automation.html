<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Report Scheduling - PMS</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">PMS</div>
            <nav class="nav">
                <a href="/dashboard" class="nav-link">Dashboard</a>
                <a href="/planning/schedule" class="nav-link">Planning</a>
                <a href="/defects/replacement-tickets" class="nav-link">Defects</a>
                <a href="/reports/automation" class="nav-link active">Reports</a>
            </nav>
            <div class="user-menu">
                <div class="notification-badge">
                    <span class="badge hidden-badge">0</span>
                    <span>ðŸ””</span>
                </div>
                <span id="username"></span>
                <button class="btn btn-sm btn-secondary logout-btn">Logout</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="page-header">
            <h1>Automated Report Scheduling</h1>
            <button class="btn btn-primary" id="createReportBtn">+ Create Report Schedule</button>
        </div>
        
        <div class="card">
            <div class="card-header">Scheduled Reports</div>
            <table class="table">
                <thead>
                    <tr>
                        <th>Report Name</th>
                        <th>Type</th>
                        <th>Schedule</th>
                        <th>Recipients</th>
                        <th>Last Run</th>
                        <th>Next Run</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="reportsTable">
                    <tr><td colspan="8" class="loading">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <div id="reportModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <span id="modalTitle">Create Automated Report</span>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="reportForm">
                <input type="hidden" id="reportId">
                
                <div class="form-section">
                    <h3 class="section-title">Report Details</h3>
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label required">Report Name</label>
                            <input type="text" id="reportName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Report Type</label>
                            <select id="reportType" class="form-select" required>
                                <option value="">Select Type...</option>
                            </select>
                        </div>
                    </div>
                    <div id="reportDescription" class="report-description"></div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Schedule Configuration</h3>
                    <div class="grid grid-3">
                        <div class="form-group">
                            <label class="form-label required">Frequency</label>
                            <select id="scheduleType" class="form-select" required>
                                <option value="manual">Manual (On-Demand)</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div class="form-group" id="scheduleTimeGroup" style="display:none;">
                            <label class="form-label required">Time</label>
                            <input type="time" id="scheduleTime" class="form-input" value="08:00">
                        </div>
                        <div class="form-group" id="scheduleDayGroup" style="display:none;">
                            <label class="form-label required">Day</label>
                            <select id="scheduleDay" class="form-select">
                                <option value="1">Monday</option>
                                <option value="2">Tuesday</option>
                                <option value="3">Wednesday</option>
                                <option value="4">Thursday</option>
                                <option value="5">Friday</option>
                                <option value="6">Saturday</option>
                                <option value="0">Sunday</option>
                            </select>
                        </div>
                        <div class="form-group" id="scheduleDateGroup" style="display:none;">
                            <label class="form-label required">Day of Month</label>
                            <input type="number" id="scheduleDate" class="form-input" min="1" max="31" value="1">
                        </div>
                    </div>
                    <div id="schedulePreview" class="schedule-preview"></div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Report Filters</h3>
                    <div class="grid grid-3">
                        <div class="form-group">
                            <label class="form-label">Date Range</label>
                            <select id="dateRange" class="form-select">
                                <option value="last_7_days">Last 7 Days</option>
                                <option value="last_30_days">Last 30 Days</option>
                                <option value="this_month">This Month</option>
                                <option value="last_month">Last Month</option>
                                <option value="this_quarter">This Quarter</option>
                                <option value="this_year">This Year</option>
                            </select>
                        </div>
                        <div class="form-group" id="departmentFilterGroup" style="display:none;">
                            <label class="form-label">Department</label>
                            <select id="departmentFilter" class="form-select">
                                <option value="">All Departments</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Output Format</label>
                            <select id="outputFormat" class="form-select">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                                <option value="html">HTML</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeCharts" checked>
                            <span>Include Charts and Visualizations</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Email Recipients</h3>
                    <div id="recipientsContainer"></div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addRecipient()">+ Add Recipient</button>
                    <p class="help-text">Enter email addresses for automatic report delivery</p>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="button" class="btn btn-secondary" id="testReportBtn">Test Report</button>
                    <button type="submit" class="btn btn-primary">Save Report Schedule</button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/modules/reports-automation.js"></script>
</body>
</html>
